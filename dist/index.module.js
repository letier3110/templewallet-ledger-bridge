import e from"@ledgerhq/hw-transport";var r;!function(e){e.ExchangeRequest="THANOS_LEDGER_BRIDGE_EXCHANGE_REQUEST",e.ExchangeResponse="THANOS_LEDGER_BRIDGE_EXCHANGE_RESPONSE",e.ErrorResponse="THANOS_LEDGER_ERROR_RESPONSE"}(r||(r={}));var t=function(e){var t,n;function o(r,t){var n;return(n=e.call(this)||this).iframe=r,n.bridgeUrl=t,n}n=e,(t=o).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,o.open=function(e){try{var r=document.createElement("iframe");return r.src=e,document.head.appendChild(r),Promise.resolve(new o(r,e))}catch(e){return Promise.reject(e)}};var i=o.prototype;return i.exchange=function(e){var t=this;return new Promise(function(n,o){var i,s,a={type:r.ExchangeRequest,apdu:e.toString(),scrambleKey:null===(i=t.scrambleKey)||void 0===i?void 0:i.toString(),exchangeTimeout:t.exchangeTimeout};null===(s=t.iframe.contentWindow)||void 0===s||s.postMessage(a,"*"),window.addEventListener("message",function e(i){if(i.origin===t.getOrigin()){var s=i.data;switch(null==s?void 0:s.type){case r.ExchangeResponse:n(Buffer.from(s.result));break;case r.ErrorResponse:o(s.message)}window.removeEventListener("message",e)}})})},i.setScrambleKey=function(e){this.scrambleKey=Buffer.from(e,"ascii")},i.setUnwrap=function(e){this.unwrap=e},i.close=function(){try{return document.head.removeChild(this.iframe),Promise.resolve()}catch(e){return Promise.reject(e)}},i.getOrigin=function(){var e=this.bridgeUrl.split("/");return e.splice(-1,1),e.join("/")},o}(e);export{r as BridgeMessageType,t as TransportThanosBridge};
//# sourceMappingURL=index.module.js.map
